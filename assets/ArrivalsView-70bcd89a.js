import{d as q,s as te,f as O,i as V,q as X,a as re,o as i,c as d,r as R,n as N,b as k,e as v,g as a,h as u,w as f,u as p,t as _,j as x,F as C,k as ie,l as S,m as B,p as G,v as J,S as le,x as L,y as W,z as Q,A as ce,_ as de,B as ue,T as me}from"./index-6ba54081.js";import{u as z,S as K}from"./SelectSkeleton-7963a42b.js";const Z=q("date",{state:()=>({currentDate:null,displayOptions:{weekday:"long",year:"numeric",month:"long",day:"numeric"},dataOptions:{year:"numeric",month:"numeric",day:"numeric"}}),getters:{displayDate(e){if(e.currentDate)return e.currentDate.toLocaleDateString("en-GB",e.displayOptions)},apiDate(e){if(e.currentDate)return e.currentDate.toLocaleDateString("en-GB",e.dataOptions).split("/").reverse().join("")},fireStoreDate(e){if(e.currentDate)return e.currentDate.toLocaleDateString("en-GB",e.dataOptions).split("/").reverse().join("-")}},actions:{setCurrentDate(e=0){let t;if(this.currentDate)t=new Date(this.currentDate.setDate(this.currentDate.getDate()+e));else{let s=new Date;t=new Date(s.setDate(s.getDate()+2))}this.currentDate=t},setCurrentDateBis(e){this.currentDate=new Date(e)}}}),ee=q("messages",{state:()=>({customMessages:[],messages:[{custom:!1,messageType:"defaultWelcomeMessage",name:"Default welcome message",variables:["guestFirstName","senderName","dayOfWeek"],text:`Hi --guestFirstName--, this is --senderName-- from the Princes Street Hostel, I hope you are well and thanks again for booking with us. Could you please let us know what time you will be arriving on --dayOfWeek--?
Please bear in mind we are at the very top of our building and there are a quite a few steps to reach reception level. See you soon!`},{custom:!1,messageType:"withArrivalTime",name:"With arrival time",variables:["guestFirstName","senderName","dayOfWeek","checkinTime"],text:`Hi --guestFirstName--, this is --senderName-- from the Princes Street Hostel, I hope you are well and thanks again for booking with us. We look forward to welcoming you on --dayOfWeek-- --checkinTime--.
Please bear in mind we are at the very top of our building and there are a quite a few steps to reach reception level. See you soon!`},{custom:!1,messageType:"earlyCheckin",name:"Early Checkin",variables:["guestFirstName","senderName","dayOfWeek","checkinTime"],text:`Hi --guestFirstName--, this is --senderName-- from the Princes Street Hostel, I hope you are well and thanks again for booking with us. We look forward to welcoming you on --dayOfWeek-- --checkinTime--.
Our official check-in time is at 3pm, however you are very welcome to leave your luggage here at reception, then you are free to explore Edinburgh!
Please bear in mind we are at the very top of our building and there are a quite a few steps to reach reception level. See you soon!`},{custom:!1,messageType:"lateCheckin",name:"Late Checkin",variables:["guestFirstName","senderName","roomNumber"],text:`Hello --guestFirstName--, this is --senderName-- from the Princes Street Hostel.
As you are checking in at a time when the reception will be closed, I have put your key in an envelope with your name on it, next to the check out box which is located directly on your right as you walk through the front door.
The door code to enter the hostel is 3578. Your room number is --roomNumber--. Turn to your left as you walk in, go down the corridor and there you will find signs to your room.
There are bathrooms and showers on your floor as well as next to reception if yours are busy in the morning.
And please switch off any lights you switch on.
There is no one at reception just now (although staff is on site in case of emergency) until tomorrow morning 8.00am so just pop by to say hi!`},{custom:!1,messageType:"emailMessage",name:"Email Message",variables:["guestFirstName","senderName","dayOfWeek"],text:`Hi --guestFirstName--, this is --senderName--, I hope you are well and thanks again for booking with us.
Could you please let us know what time you will be arriving --dayOfWeek-- and also if you have a WhatsApp number?
Please bear in mind we are at the very top of our building and there are a quite a few steps to reach reception level. See you soon!`}]}),getters:{},actions:{setCustomMessages(e){this.customMessages=e}}}),b=Z(),se=ee(),w=z(),A=q("bookings",{state:()=>({bookings:null,isSendingMail:!1,isLoadingData:!1,isWritingData:!1}),getters:{getBookings(e){return e.bookings?e.bookings[b.apiDate]:null},getNumberOfGuests(){return this.getBookings?this.getBookings.length:0},filteredBookings(){const e=w.currentTypeFilter,t=w.currentStatus;let s=this.getBookings;return e!=="all"&&(s=s.filter(o=>o.type===e)),t!=="all"&&(t==="todo"?s=s.filter(o=>o.status==="todo"||o.status==="inProgress"):s=s.filter(o=>o.status===t)),s}},actions:{setCustomMessage(e,t){let s=this.bookings[b.apiDate].map(o=>{if(o.bookId===e){o.custom=!0,o.messageType=`custom-${t}`;const n=se.customMessages.find(r=>r.messageType===t),{text:c,variables:g}=n,y=w.currentSender?w.currentSender:"--senderName--";let l=JSON.parse(c);for(const r of g){let m=o[r]?o[r]:r==="senderName"?y:`--${r}--`;l=l.replace(`--${r}--`,m)}o.text=l}return o});this.bookings={...this.bookings,[b.apiDate]:s}},setMessage(e,t){let s="",o=this.bookings[b.apiDate].map(n=>{if(n.bookId===e){n.messageType=t,n.custom=!1,t==="emailMessage"?n.type="email":n.type="whatsapp";const c=se.messages.find(m=>m.messageType===t),{text:g,variables:y}=c,l=w.currentSender?w.currentSender:"--senderName--";let r=g;for(const m of y){let h=n[m]?n[m]:m==="senderName"?l:`--${m}--`;r=r.replace(`--${m}--`,h)}n.text=r,s=this.replaceVariablesInText(n,c)}return n});te(`guests/${b.apiDate}/bookings/${e}`,{messageType:t,type:t==="emailMessage"?"email":"whatsapp",text:s}),this.bookings={...this.bookings,[b.apiDate]:o}},setCurrentText(e,t){let s=this.bookings[b.apiDate].map(o=>(o.bookId===e&&(o.text=t),o));this.bookings={...this.bookings,[b.apiDate]:s}},setSenderName(e){let t=this.bookings[b.apiDate].map(s=>{const o=w.lastSender,{text:n}=s;let c=n.search("--senderName--"),g;return c!==-1?g=n.replace("--senderName--",e):g=n.replace(o,e),s.text=g,s});this.bookings={...this.bookings,[b.apiDate]:t},w.setLastSender(e)},replaceVariablesInText(e,t){const{text:s,variables:o}=t;let n=s;for(const c of o){let g=e[c]?e[c]:`--${c}--`;n=n.replace(`--${c}--`,g)}return n},async writeGuestsData(e=!1){try{this.isWritingData=!0;const t="getArrivals?date="+b.apiDate+(e?"&updateData=true":""),o=await(await fetch(O+t)).json();if(o.success)return o;V("Error while writing data",{position:V.POSITION.BOTTOM_RIGHT,autoClose:!1,type:"error"})}catch{}finally{this.isWritingData=!1}},async loadGuestsData(){try{this.isLoadingData=!0;const e=await X(`guests/${b.apiDate}/bookings`,"guestName");this.bookings={...this.bookings,[b.apiDate]:e},w.currentSender&&this.setSenderName(w.currentSender)}catch{V("Error while loading data",{position:V.POSITION.BOTTOM_RIGHT,autoClose:!1,type:"error"})}finally{this.isLoadingData=!1}},async updateBooking(e,t){try{await te(`guests/${b.apiDate}/bookings/${e}`,t),this.loadGuestsData()}catch(s){console.log("Error while updating booking: ",s)}},async updateGuestPhone(e,t){try{const s="updateGuestPhone?bookId="+e+"&guestPhone="+t,n=await(await fetch(O+s)).json();if(n.success)return await this.updateBooking(e,{phone:n.phone}),{success:!0};console.log("Error in updateGuestPhone: ",error)}catch(s){console.log("Error in updateGuestPhone: ",s)}},async updateArrivalTimeSectionEdit(e,t){try{const s="updateArrivalTimeSectionEdit?bookId="+e+"&arrivalTimeText="+t,n=await(await fetch(O+s)).json();if(n.success)return await this.updateBooking(e,{arrivalTime:n.text}),{success:!0}}catch(s){console.log("Error in updateArrivalTimeSectionEdit: ",s)}},async updateArrivalTimeSection(e,t,s){try{const o="updateBeds24ArrivalTimeSection?bookId="+e+"&previousArrivalTimeText="+s+"&type="+t,c=await(await fetch(O+o)).json();c.success&&this.updateBooking(e,{arrivalTime:c.text})}catch(o){console.log("Error in updateArrivalTimeSection: ",o)}},async sendEmail(e){try{this.isSendingMail=!0;const t="sendEmail?guestEmail="+e.email+"&text="+JSON.stringify(e.text),o=await(await fetch(O+t)).json();o.success?(this.updateBooking(e.bookId,{status:"done"}),this.updateArrivalTimeSection(e.bookId,e.type,e.arrivalTime)):(this.updateBooking(e.bookId,{status:"error"}),console.log("Error in sendEmail: ",o.error))}finally{this.isSendingMail=!1}},async sendEmailSimple(e){try{this.isSendingMail=!0;const t="sendEmail?guestEmail="+e.email+"&text="+JSON.stringify(e.text),o=await(await fetch(O+t)).json();o.success||console.log("Error in sendEmailSimple: ",o.error)}finally{this.isSendingMail=!1}}}}),I=q("click-counter",{state:()=>({logNames:{data_firstLoad:"data_firstLoad",data_mainLoad:"data_mainLoad",data_refreshData:"data_refreshData",date_previous:"date_previous",date_next:"date_next",date_calendar:"date_calendar",filter_name:"filter_name",filter_type:"filter_type",filter_status:"filter_status",card_phoneDisplayInput:"card_phoneDisplayInput",card_phoneCloseInput:"card_phoneCloseInput",card_phoneUpdate:"card_phoneUpdate",card_arrivalTimeDisplayInput:"card_arrivalTimeDisplayInput",card_arrivalTimeCloseInput:"card_arrivalTimeCloseInput",card_arrivalTimeUpdate:"card_arrivalTimeUpdate",card_messageType:"card_messageType",card_text:"card_text",card_customWhatsApp:"card_customWhatsApp",card_customMail:"card_customMail",card_mail:"card_Mail",card_whatsApp:"card_whatsApp"}}),actions:{async log(e){const t=new Date,s=t.toLocaleDateString().split("/").reverse().join(""),o=t.toLocaleTimeString();try{await re(`logs/${s}/${this.logNames[e]}`,{time:o,navigator:navigator.userAgent})}catch(n){console.log(n)}}}}),pe=["title"],oe={__name:"DateItem",props:["title","preventClick","increaseBy"],setup(e){return(t,s)=>(i(),d("span",{title:e.title,onClick:s[0]||(s[0]=o=>t.$emit("increaseDate",e.increaseBy)),class:N([e.preventClick&&"prevent-click"])},[R(t.$slots,"icon")],10,pe))}},ge={class:"min-w-0 overflow-hidden bg-white"},he={class:"p-4 flex items-center h-full"},ye={class:"flex-1 flex items-center justify-center text-gray-500"},fe={class:"flex items-center justify-center text-sm sm:text-base text-center tracking-wider font-medium uppercase text-gray-500 px-2 sm:px-8 sm:w-96 select-none"},_e=["value"],ve={class:"text-xs"},be={__name:"Date",setup(e){const t=Z(),s=A(),o=I(),n=k(()=>!s.getNumberOfGuests||s.isWritingData),c=l=>{o.log(l>0?"date_next":"date_previous"),t.setCurrentDate(l),s.loadGuestsData()},g=l=>{o.log("date_calendar"),t.setCurrentDateBis(l.target.value),s.loadGuestsData()},y=()=>{o.log("date_updateData"),s.writeGuestsData(!0).then(l=>{(l==null?void 0:l.length)>0&&s.loadGuestsData()})};return(l,r)=>{const m=v("LeftTriangleIcon"),h=v("RefreshIcon"),D=v("RightTriangleIcon");return i(),d("div",ge,[a("div",he,[a("div",ye,[u(oe,{title:"Previous date",preventClick:p(s).isLoadingData,increaseBy:-1,onIncreaseDate:c},{icon:f(()=>[u(m,{class:"py-1 px-2 w-10 h-8 border bg-gray-100 rounded-md cursor-pointer hover:bg-gray-200 hover:text-gray-600"})]),_:1},8,["preventClick"]),a("p",fe,[a("div",null,[a("div",null,[a("input",{class:"focus:outline-none",type:"date",name:"calendar",id:"calendar",value:p(t).fireStoreDate,onChange:g},null,40,_e)]),a("div",ve,_(p(t).displayDate),1)]),a("span",{title:"Update data",onClick:y,class:N([n.value&&"prevent-click","sm:ml-4"])},[u(h,{class:"py-1 px-2 w-10 h-8 cursor-pointer hover:text-gray-600"})],2)]),u(oe,{title:"Next date",preventClick:p(s).isLoadingData,increaseBy:1,onIncreaseDate:c},{icon:f(()=>[u(D,{class:"py-1 px-2 w-10 h-8 border bg-gray-100 rounded-md cursor-pointer hover:bg-gray-200 hover:text-gray-600"})]),_:1},8,["preventClick"])])])])}}},ke={class:"min-w-0 overflow-hidden shadow-md bg-white border-t-4 border-blue-500"},xe={class:"p-4 flex items-center"},we={"data-cy":"icon",class:"p-3 rounded-full text-blue-500 bg-blue-100 mr-4"},Se={"data-cy":"title",class:"mb-2 text-sm font-normal text-gray-600"},Te={"data-cy":"data",class:"text-base font-normal text-gray-700"},H={__name:"TopCard",props:["title"],setup(e){return(t,s)=>(i(),d("div",ke,[a("div",xe,[a("div",we,[R(t.$slots,"icon")]),a("div",null,[a("p",Se,_(e.title),1),a("p",Te,[R(t.$slots,"data")])])])]))}},$e={__name:"TopCards",props:["bookings"],setup(e){const t=e,s=k(()=>t.bookings?t.bookings.length:0),o=k(()=>t.bookings?t.bookings.filter(r=>r.status==="done"&&r.type==="whatsapp").length:0),n=k(()=>t.bookings?t.bookings.filter(r=>r.type==="whatsapp").length:0),c=k(()=>t.bookings?t.bookings.filter(r=>r.status==="done"&&r.type==="email").length:0),g=k(()=>t.bookings?t.bookings.filter(r=>r.type==="email").length:0),y=k(()=>t.bookings?t.bookings.filter(r=>r.status==="done").length:0),l=k(()=>g.value+n.value);return(r,m)=>{const h=v("GuestsIcon"),D=v("WhatsAppIcon"),M=v("EmailIcon"),j=v("ProgressionIcon");return i(),d(C,null,[u(H,{"data-cy":"guests",class:"col-span-12 sm:col-span-6 lg:col-span-3",title:"Guests"},{icon:f(()=>[u(h,{class:"w-5 h-5"})]),data:f(()=>[x(_(s.value),1)]),_:1}),u(H,{"data-cy":"whatsapp",class:"col-span-12 sm:col-span-6 lg:col-span-3",title:"WhatsApp"},{icon:f(()=>[u(D,{class:"w-5 h-5"})]),data:f(()=>[x(_(o.value)+" / "+_(n.value),1)]),_:1}),u(H,{"data-cy":"email",class:"col-span-12 sm:col-span-6 lg:col-span-3",title:"Email"},{icon:f(()=>[u(M,{class:"w-5 h-5"})]),data:f(()=>[x(_(c.value)+" / "+_(g.value),1)]),_:1}),u(H,{"data-cy":"progression",class:"col-span-12 sm:col-span-6 lg:col-span-3",title:"Progression"},{icon:f(()=>[u(j,{class:"w-5 h-5"})]),data:f(()=>[x(_(y.value)+" / "+_(l.value),1)]),_:1})],64)}}},Ie=a("option",{disabled:"",value:""},"Sender name",-1),De=["value"],Ce={__name:"SenderName",async setup(e){let t,s;const o=z(),n=A(),c=I();let g=([t,s]=ie(()=>X("senders","created_at")),t=await t,s(),t);return o.setSenders(g==null?void 0:g.map(y=>y.name)),o.$subscribe((y,l)=>{l.currentSender&&n.setSenderName(l.currentSender)}),(y,l)=>(i(),S(K,{class:"sm:my-4"},{default:f(()=>[B(a("select",{"onUpdate:modelValue":l[0]||(l[0]=r=>p(o).currentSender=r),class:"select",name:"senderName",id:"senderName",onClick:l[1]||(l[1]=r=>p(c).log("filter_name"))},[Ie,(i(!0),d(C,null,G(p(o).senders,r=>(i(),d("option",{value:r},_(r),9,De))),256))],512),[[J,p(o).currentSender]])]),_:1}))}},Ne=a("option",{disabled:""},"Type",-1),Be=["value"],P=z();P.setCurrentTypeFilter(P.typeFilters[0].value);const Ae=I(),Me={__name:"Type",setup(e){return(t,s)=>(i(),S(K,{class:"sm:my-4"},{default:f(()=>[B(a("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>p(P).currentTypeFilter=o),class:"select",name:"type",id:"type",onClick:s[1]||(s[1]=o=>p(Ae).log("filter_type"))},[Ne,(i(!0),d(C,null,G(p(P).typeFilters,o=>(i(),d("option",{value:o.value},_(o.displayName),9,Be))),256))],512),[[J,p(P).currentTypeFilter]])]),_:1}))}},Ee=a("option",{disabled:""},"Status",-1),Oe=["value"],U=z();U.setCurrentStatus(U.statuses[0].value);const Ge=I(),Le={__name:"Status",setup(e){return(t,s)=>(i(),S(K,{class:"sm:my-4"},{default:f(()=>[B(a("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>p(U).currentStatus=o),class:"select",name:"status",id:"status",onClick:s[1]||(s[1]=o=>p(Ge).log("filter_status"))},[Ee,(i(!0),d(C,null,G(p(U).statuses,o=>(i(),d("option",{value:o.value},_(o.displayName),9,Oe))),256))],512),[[J,p(U).currentStatus]])]),_:1}))}},We={class:"grid gap-6 my-8 sm:grid-cols-12"},Pe=a("div",null,"loading...",-1),Ue={__name:"ArrivalsMenu",props:["bookings"],setup(e){return(t,s)=>(i(),d("div",We,[u(be,{class:"col-span-12"}),u($e,{bookings:e.bookings},null,8,["bookings"]),(i(),S(le,null,{fallback:f(()=>[Pe]),default:f(()=>[u(Ce,{class:"col-span-12 sm:col-span-4"})]),_:1})),u(Me,{class:"col-span-12 sm:col-span-4"}),u(Le,{class:"col-span-12 sm:col-span-4"})]))}},je={class:"flex flex-col mb-12 justify-center items-center text-gray-500"},Fe=a("span",{class:"my-8 text-xl font-semi-bold"},"NO DATA",-1),Ve={__name:"NoGuests",props:["preventClick"],setup(e){return(t,s)=>{const o=v("LoadIcon");return i(),d("div",je,[Fe,a("span",{onClick:s[0]||(s[0]=n=>t.$emit("writeData")),class:N(e.preventClick&&"prevent-click"),title:"Load data"},[u(o,{class:"my-2 py-9 px-4 w-24 h-24 border bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 hover:text-gray-600"})],2)])}}},He={class:"status-card lg:flex-none"},Re={class:"flex justify-end"},Y={__name:"CardSkeleton",props:["bookId"],setup(e){return(t,s)=>{const o=v("CancelIcon");return i(),d("div",He,[a("div",Re,[u(o,{onClick:s[0]||(s[0]=n=>t.$emit("updateBooking",e.bookId,{status:"todo"})),title:"Cancel",class:"w-6 h-6 cursor-pointer"})]),R(t.$slots,"default")])}}},qe={class:"flex-1 px-6 py-8 bg-white lg:p-12"},Je={class:"text-2xl font-extrabold text-gray-900 sm:text-3xl"},ze={class:"mt-6 text-base text-gray-500 truncate"},Ke={key:0},Ye=a("br",null,null,-1),Qe={class:"flex items-center"},Xe={key:0},Ze={key:1},et={key:2},tt={"data-cy":"email"},st={class:"mt-8"},ot=a("div",{class:"flex items-center"},[a("h4",{class:"flex-shrink-0 pr-4 text-sm font-semibold tracking-wider uppercase bg-white"}," Guest infos "),a("div",{class:"flex-1 border-t-2 border-gray-200"})],-1),at={class:"mt-8 space-y-5"},nt={class:"lg:col-span-1"},rt={class:"flex items-center"},it=a("p",{class:"text-gray-900"},"Arrival time",-1),lt={key:0},ct={key:0,"data-cy":"arrival-time",class:"text-sm text-gray-700"},dt={key:1},ut={class:"lg:col-span-1"},mt=a("p",{class:"text-gray-900"},"Comments",-1),pt=["innerHTML"],gt={__name:"CardInfos",props:["booking"],setup(e){const t=e,s=A(),o=I(),n=L(!1),c=L(t.booking.arrivalTime),g=()=>{o.log("card_arrivalTimeDisplayInput"),n.value=!0,c.value=t.booking.arrivalTime},y=()=>{o.log("card_arrivalTimeCloseInput"),n.value=!1,c.value=t.booking.arrivalTime},l=async()=>{o.log("card_arrivalTimeUpdate");try{await s.updateArrivalTimeSectionEdit(t.booking.bookId,c.value)}finally{n.value=!1}},r=L(!1),m=L(t.booking.phone),h=()=>{o.log("card_phoneDisplayInput"),r.value=!0,m.value=t.booking.phone},D=()=>{o.log("card_phoneCloseInput"),r.value=!1,m.value=t.booking.phone},M=async()=>{o.log("card_phoneUpdate");try{await s.updateGuestPhone(t.booking.bookId,m.value)}finally{r.value=!1}};return(j,E)=>{const F=v("EditIcon");return i(),d("div",qe,[a("h3",Je,_(e.booking.name),1),a("p",ze,[e.booking.groupReservation?(i(),d("span",Ke,[x("(group of "+_(e.booking.personsInGroup)+")",1),Ye])):W("",!0),a("div",Qe,[r.value?W("",!0):(i(),d("div",Xe,_(e.booking.phone?e.booking.phone:"No phone"),1)),r.value?(i(),d("div",et,[B(a("input",{"onUpdate:modelValue":E[0]||(E[0]=T=>m.value=T),type:"text",spellcheck:"false",placeholder:"Update Guest phone",class:"mt-2 text-sm px-4 py-1 border border-gray-200 rounded-sm focus:shadow-md focus:outline-none mb-2"},null,512),[[Q,m.value]]),a("div",{class:"flex gap-4 mb-5"},[a("button",{onClick:M,class:"text-sm py-1 bg-white hover:bg-gray-100 border border-gray-200 rounded-sm w-20"}," Save "),a("button",{"data-cy":"cancel",onClick:D,class:"text-sm py-1 bg-white hover:bg-gray-100 border border-gray-200 rounded-sm w-20"}," Cancel ")])])):(i(),d("div",Ze,[u(F,{onClick:h,class:"ml-2 h-3 w-3 cursor-pointer",title:"Edit Guest phone section in Beds24"})]))]),a("span",tt,_(e.booking.email?e.booking.email:"No email"),1)]),a("div",st,[ot,a("ul",at,[a("li",nt,[a("div",rt,[it,n.value?W("",!0):(i(),d("div",lt,[u(F,{"data-cy":"edit arrival time",onClick:g,class:"ml-2 h-3 w-3 cursor-pointer",title:"Edit Arrival time section in Beds24"})]))]),n.value?(i(),d("div",dt,[B(a("input",{"data-cy":"input","onUpdate:modelValue":E[1]||(E[1]=T=>c.value=T),type:"text",spellcheck:"false",placeholder:"Update Arrival time text",class:"mt-2 text-sm px-4 py-1 border border-gray-200 rounded-sm focus:shadow-md focus:outline-none mb-2"},null,512),[[Q,c.value]]),a("div",{class:"flex gap-4"},[a("button",{onClick:l,class:"text-sm py-1 bg-white hover:bg-gray-100 border border-gray-200 rounded-sm w-20"}," Save "),a("button",{"data-cy":"cancel",onClick:y,class:"text-sm py-1 bg-white hover:bg-gray-100 border border-gray-200 rounded-sm w-20"}," Cancel ")])])):(i(),d("p",ct,_(e.booking.arrivalTime?e.booking.arrivalTime:"No data"),1))]),a("li",ut,[mt,a("p",{"data-cy":"comments",class:"text-sm text-gray-700",innerHTML:`${e.booking.guestCommentsModified?e.booking.guestCommentsModified:"No data"}`},null,8,pt)])])])])}}},ht=["name","id"],yt={label:"Premade"},ft=["value"],_t={label:"Custom"},vt=["value"],bt={__name:"MessageType",props:["bookId","messageType"],setup(e){const t=e,s=ee(),o=A(),n=I(),c=L();ce(async()=>{c.value=await X("messages","created_at"),s.setCustomMessages(c.value)});const g=k({get(){return t.messageType},set(y){y.includes("custom-")?o.setCustomMessage(t.bookId,y.replace("custom-","")):o.setMessage(t.bookId,y)}});return(y,l)=>(i(),S(K,null,{default:f(()=>[B(a("select",{class:"select",name:"messages-"+e.bookId,id:"messages-"+e.bookId,"onUpdate:modelValue":l[0]||(l[0]=r=>g.value=r),onClick:l[1]||(l[1]=r=>p(n).log("card_messageType"))},[a("optgroup",yt,[(i(!0),d(C,null,G(p(s).messages,r=>(i(),d("option",{value:r.messageType},_(r.name),9,ft))),256))]),a("optgroup",_t,[(i(!0),d(C,null,G(c.value,r=>(i(),d("option",{value:`custom-${r.messageType}`},_(r.name),9,vt))),256))])],8,ht),[[J,g.value]])]),_:1}))}};const kt={class:"border border-gray-300 rounded flex flex-col text-gray-800 bg-white shadow-md"},xt=a("div",{class:"bg-gray-200 px-3 py-2 border-b border-gray-300"},[a("h3",{class:"text-sm text-left font-medium"},"Output")],-1),wt={__name:"Text",props:["bookId","text"],setup(e){const t=e,s=A(),o=I(),n=k({get(){return t.text},set(c){s.setCurrentText(t.bookId,c)}});return(c,g)=>(i(),d("div",kt,[xt,B(a("textarea",{"onUpdate:modelValue":g[0]||(g[0]=y=>n.value=y),rows:"6",spellcheck:"false",placeholder:"Text to be sent to the guest",class:"flex-1 p-2 m-1 focus:outline-none",name:"output",onClick:g[1]||(g[1]=y=>p(o).log("card_text"))},null,512),[[Q,n.value]])]))}};const St={class:"pb-6"},Tt={class:"shadow-md lg:flex"},$t={key:0,class:"status-card"},It={class:"mt-8"},Dt={key:0,class:"block sm:flex sm:justify-between"},Ct=["href"],Nt={key:2,class:"action-button rounded-md shadow"},Bt=["href"],At={class:"flex flex-1 flex-col justify-center"},Mt=a("div",{class:"m-16"},[a("h1",{class:"mb-4 text-lg font-medium leading-6 text-gray-900"}," Message successfully sent ? "),a("h2",{class:"text-sm text-gray-500"}," A successfull sending will update the Arrival time section. ")],-1),Et={class:"flex justify-around flex-wrap mb-4"},Ot={class:"flex flex-1 m-12 justify-center items-center"},Gt=a("div",{class:"flex flex-1 m-12 justify-center items-center"},"Error",-1),Lt={key:4,class:"status-card"},Wt=a("div",{class:"flex flex-1 m-12 justify-center items-center"},[x(" There is no way to contact the guest "),a("br"),x(" (no phone and no email) ")],-1),Pt=[Wt],Ut={__name:"Card",props:["booking"],setup(e){const t=e,s=A(),o=ee(),n=I(),c=k(()=>{let m=encodeURI(t.booking.text);return`https://web.whatsapp.com/send?phone=${t.booking.phone}&text=${m}`}),g=m=>{n.log("card_mail"),s.sendEmail(m)},y=m=>{n.log("card_customMail"),s.sendEmailSimple(m)},l=(m,h)=>{s.updateBooking(m,h)},r=(m,h)=>{s.updateBooking(m.bookId,h),s.updateArrivalTimeSection(m.bookId,m.type,m.arrivalTime)};return(m,h)=>{const D=v("WhatsAppIcon"),M=v("EmailLightIcon"),j=v("ThumbsDownIcon"),E=v("ThumbsUpIcon"),F=v("SentIcon");return i(),d("div",St,[a("div",Tt,[u(gt,{booking:e.booking},null,8,["booking"]),e.booking.status==="todo"?(i(),d("div",$t,[u(bt,{bookId:e.booking.bookId,messageType:e.booking.messageType},null,8,["bookId","messageType"]),u(wt,{bookId:e.booking.bookId,text:e.booking.text,class:"mt-6"},null,8,["bookId","text"]),a("div",It,[e.booking.custom?(i(),d("div",Dt,[a("a",{href:c.value,target:"_blank",class:N([!e.booking.phone&&"prevent-click","mb-4 sm:mb-0 flex justify-center w-full sm:w-1/3 border border-gray-400 rounded-md py-3 px-5 text-gray-700 bg-white cursor-pointer hover:bg-gray-100"]),onClick:h[0]||(h[0]=T=>p(n).log("card_customWhatsApp"))},[x(" Open in "),u(D,{class:"w-6 h-6 ml-2"})],10,Ct),a("div",{onClick:h[1]||(h[1]=T=>y(e.booking)),class:N([!e.booking.email&&"prevent-click",p(s).isSendingMail?"prevent-click":"","flex justify-center w-full sm:w-1/3 border border-gray-400 rounded-md py-3 px-5 text-gray-700 bg-white cursor-pointer hover:bg-gray-100"])},[x(" Send email "),u(M,{class:"w-6 h-6 ml-2"})],2)])):e.booking.type==="email"?(i(),d("div",{key:1,class:N(["action-button rounded-md shadow cursor-pointer",[p(s).isSendingMail?"prevent-click":"","main-action-button text-red-600 border-red-600 hover:bg-red-200"]]),onClick:h[2]||(h[2]=T=>g(e.booking))},[x(" Send email "),u(M,{class:"w-6 h-6 ml-2"})],2)):e.booking.type==="whatsapp"?(i(),d("div",Nt,[a("a",{onClick:h[3]||(h[3]=T=>{l(e.booking.bookId,{status:"inProgress"}),p(n).log("card_whatsApp")}),href:c.value,class:N(["main-action-button text-green-600 border-green-600  hover:bg-green-200"]),target:"_blank"},[x(" Open in "),u(D,{class:"w-6 h-6 ml-2"})],8,Bt)])):W("",!0)])])):e.booking.status==="inProgress"?(i(),S(Y,{key:1,bookId:e.booking.bookId,onUpdateBooking:l},{default:f(()=>[a("div",At,[Mt,a("div",Et,[a("div",{onClick:h[4]||(h[4]=T=>l(e.booking.bookId,{status:"todo",type:"email",messageType:"emailMessage",text:p(s).replaceVariablesInText(e.booking,p(o).messages.find(ne=>ne.messageType==="emailMessage"))})),class:"progress-wrapper bg-white border-red-500 text-red-500 hover:bg-red-100",title:"Fail"},[u(j,{class:"w-6 h-6"})]),a("div",{onClick:h[5]||(h[5]=T=>r(e.booking,{status:"done"})),class:"progress-wrapper border-green-500 text-green-500 bg-white hover:bg-green-100",title:"Success"},[u(E,{class:"w-6 h-6"})])])])]),_:1},8,["bookId"])):e.booking.status==="done"?(i(),S(Y,{key:2,bookId:e.booking.bookId,onUpdateBooking:l},{default:f(()=>[a("div",Ot,[u(F,{class:"w-12 h-12 text-green-500"})])]),_:1},8,["bookId"])):e.booking.status==="error"?(i(),S(Y,{key:3,bookId:e.booking.bookId,onUpdateBooking:l},{default:f(()=>[Gt]),_:1},8,["bookId"])):e.booking.status==="other"?(i(),d("div",Lt,Pt)):W("",!0)])])}}};const jt={},Ft={class:"pb-6"},Vt=ue('<div class="animate-pulse shadow-md lg:flex border border-slate-300"><div class="flex-1 px-6 py-8 bg-white lg:p-12"><div class="w-80 h-2 bg-slate-200 rounded"></div><div class="w-32 mt-6 h-2 bg-slate-200 rounded"></div><div class="w-40 mt-6 h-2 bg-slate-200 rounded"></div></div><div class="status-card"><div class="h-10"></div></div></div>',1),Ht=[Vt];function Rt(e,t){return i(),d("div",Ft,Ht)}const qt=de(jt,[["render",Rt]]);const Jt={key:1},zt={key:2},Kt=Z(),$=A(),ae=I();Kt.setCurrentDate();$.loadGuestsData();ae.log("data_firstLoad");const Xt={__name:"ArrivalsView",setup(e){const t=()=>{ae.log("data_mainLoad"),$.writeGuestsData().then(s=>{(s==null?void 0:s.length)>0&&$.loadGuestsData()})};return(s,o)=>(i(),d(C,null,[u(Ue,{bookings:p($).getBookings},null,8,["bookings"]),p($).isWritingData?(i(),S(qt,{key:0})):!p($).getNumberOfGuests&&!p($).isLoadingData?(i(),d("div",Jt,[u(Ve,{onWriteData:t,preventClick:p($).isWritingData},null,8,["preventClick"])])):(i(),d("div",zt,[u(me,{name:"cards"},{default:f(()=>[(i(!0),d(C,null,G(p($).filteredBookings,n=>(i(),S(Ut,{booking:n,key:n.bookId},null,8,["booking"]))),128))]),_:1})]))],64))}};export{Xt as default};
